window.particleNode=null;let SvgTools=require("./svg-tools.js"),ParticleData=require("../game/particleData.js");module.exports={_isInit:!1,init(t,e){if(this._isInit)return;let a=document.getElementById("game-preview-editor");a.style.width=t,a.style.height=e,cc.view.resizeWithBrowserSize(!0),cc.view.setCanvasSize(t,e),SvgTools.init(t,e),this._isInit=!0;let i=new cc.Scene;i.name="test-scene";let o=new cc.Node;o.x=0,o.y=0,o.name="Canvas",o.width=t,o.height=e;let n=o.addComponent(cc.Canvas);n.designResolution.width=t,n.designResolution.height=e,i.addChild(o);let c=new cc.Node;c.addComponent(cc.Label);o.addChild(c),cc.director.runSceneImmediate(i),cc.view.setDesignResolutionSize(t,e,cc.ResolutionPolicy.SHOW_ALL);let r=new cc.Node;r.x=0,r.y=0;let l=r.addComponent(cc.ParticleSystem);l.custom=!1,o.addChild(r),this._initParticleBridge(r),window.plugin._loadTempParticle("atom.plist")},_testParticle(){setTimeout(function(){window.particle.node.getComponent(cc.ParticleSystem);ParticleData.init()},500)},_initParticleBridge(t){window.particle={},window.particle.node=t,window.particle.script=t.getComponent(cc.ParticleSystem),window.particle.svgMove=function(e){let a=cc.view.getDesignResolutionSize(),i={left:0,top:0,width:a.width,height:a.height};cc.view._convertMouseToLocationInView(e,i);let o=t.parent.convertToNodeSpaceAR(e);t.setPosition(o)}.bind(this),window.particle.getNodeWorldPositionInSvg=function(){let e=t.convertToWorldSpaceAR(cc.v2(0,0)),a=cc.view.getDesignResolutionSize(),i={left:0,top:0,width:a.width,height:a.height};return cc.view.convertToLocationInView(e.x,e.y,i)},window.particle.getParticleSourcePositionVariance=function(){let e=t.getComponent(cc.ParticleSystem);return e?e.posVar:cc.v2(0,0)},window.particle.svgEmmitAreaSize=function(e,a){let i=t.getComponent(cc.ParticleSystem);i&&(i.posVar.x=e,i.posVar.y=a,ParticleData.data.sourcePositionVariancex=e,ParticleData.data.sourcePositionVariancey=a,ParticleData.data.emmitAreaSize.width=2*e,ParticleData.data.emmitAreaSize.height=2*a)},window.particle.getEmmitAngle=function(){let e=t.getComponent(cc.ParticleSystem);return e?{angle:e.angle,angleVar:e.angleVar,speed:e.speed}:null},window.particle.updateEmmitAngleVar=function(e){let a=t.getComponent(cc.ParticleSystem);a&&(a.angleVar=e,ParticleData.data.angleVariance=e)},window.particle.updateEmmitAngle=function(e){let a=t.getComponent(cc.ParticleSystem);a&&(a.angle=e||360,ParticleData.data.angle=e)},window.particle.getType=function(){let e=t.getComponent(cc.ParticleSystem);return e?{positionType:e.positionType,emitterMode:e.emitterMode}:null},window.particle.getEmmitSpeed=function(){let e=t.getComponent(cc.ParticleSystem);return e?e.speed:0},window.particle.setEmmitSpeed=function(e){let a=t.getComponent(cc.ParticleSystem);a&&(a.speed=e,ParticleData.data.speed=e)},window.particle.setGravity=function(e,a){let i=t.getComponent(cc.ParticleSystem);i&&(i.gravity.x=e,i.gravity.y=a,ParticleData.data.gravityx=e,ParticleData.data.gravityy=a)},window.particle.setRadius=function(e,a){let i=t.getComponent(cc.ParticleSystem);i&&(i.startRadius=a,i.endRadius=e,ParticleData.data.minRadius=e,ParticleData.data.maxRadius=a)},window.particle.getRadius=function(){let e=t.getComponent(cc.ParticleSystem);return e?{endR:e.endRadius,startR:e.startRadius,rotationPreS:e.rotatePerS}:null},window.particle.setStartColor=function(e){let a=t.getComponent(cc.ParticleSystem);if(a){let t=cc.color(e);a.startColor=t,ParticleData.data.startColorAlpha=t.a/255,ParticleData.data.startColorBlue=t.b/255,ParticleData.data.startColorRed=t.r/255,ParticleData.data.startColorGreen=t.g/255}},window.particle.setStartColorVar=function(e){let a=t.getComponent(cc.ParticleSystem);if(a){let t=cc.color(e);a.startColorVar=t,ParticleData.data.startColorVarianceAlpha=t.a/255,ParticleData.data.startColorVarianceBlue=t.b/255,ParticleData.data.startColorVarianceRed=t.r/255,ParticleData.data.startColorVarianceGreen=t.g/255}},window.particle.setEndColor=function(e){let a=t.getComponent(cc.ParticleSystem);if(a){let t=cc.color(e);a.endColor=t,ParticleData.data.endColorAlpha=t.a/255,ParticleData.data.endColorBlue=t.b/255,ParticleData.data.endColorRed=t.r/255,ParticleData.data.endColorGreen=t.g/255}},window.particle.setEndColorVar=function(e){let a=t.getComponent(cc.ParticleSystem);if(a){let t=cc.color(e);a.endColorVar=t,ParticleData.data.finishColorVarianceAlpha=t.a/255,ParticleData.data.finishColorVarianceBlue=t.b/255,ParticleData.data.finishColorVarianceRed=t.r/255,ParticleData.data.finishColorVarianceGreen=t.g/255}}},_moveParticle(t){let e=window.particle.node;if(e){let a=e.getPosition(),i=t.touch.getDelta();a.x+=i.x,a.y+=i.y,e.setPosition(a)}},_addTouchEvent(t){t.on(cc.Node.EventType.TOUCH_START,function(t){this._moveParticle(t)},this),t.on(cc.Node.EventType.TOUCH_MOVE,function(t){this._moveParticle(t)},this),t.on(cc.Node.EventType.TOUCH_END,function(t){this._moveParticle(t)},this)}};