let svgPath=Path.join(__dirname,"../node_modules/svg.js");const SVG=require(svgPath),ChromaJs=require("chroma-js"),Message=require("../Message.js");module.exports={_curTool:null,_curKey:null,_testClass(){},resize(i,o){this.draw.size(i,o),this.refresh()},refresh(){setTimeout(function(){this._updateTools({keyCode:this._curKey})}.bind(this),100)},init(i,o){this.draw=SVG("drawing").size(i,o);let e=this;window.addEventListener("keydown",function(i){e._updateTools(i)})},loaded(){this._updateTools({keyCode:this.ShortKey.GravityRadius})},_resetToolFlag(){window.plugin.isAreaSizeTool=!1,window.plugin.isPositionTool=!1,window.plugin.isGravityTool=!1,window.plugin.isAngleTool=!1,window.plugin.isRadiusTool=!1,window.plugin.tips=""},ShortKey:{Position:cc.macro.KEY?cc.macro.KEY.q:cc.KEY.q,AreaSize:cc.macro.KEY?cc.macro.KEY.w:cc.KEY.w,EmmitAngle:cc.macro.KEY?cc.macro.KEY.e:cc.KEY.e,GravityRadius:cc.macro.KEY?cc.macro.KEY.r:cc.KEY.r},_updateTools(i){this._curTool&&this._curTool._onMsg&&window.plugin.$off(Message.MessagePipe,this._curTool._onMsg),this._resetToolFlag(),this.draw.clear();let o=null;if(this._curKey=i.keyCode,i.keyCode===this.ShortKey.Position)o=this.initPositionTools(),window.plugin.isPositionTool=!0,window.plugin.tips="位移";else if(i.keyCode===this.ShortKey.AreaSize)o=this.initEmmitAreaTools(),window.plugin.isAreaSizeTool=!0,window.plugin.tips="发射区域";else if(i.keyCode===this.ShortKey.EmmitAngle)o=this.initEmmitAngleTools(),window.plugin.isAngleTool=!0,window.plugin.tips="发射角度";else if(i.keyCode===this.ShortKey.GravityRadius){let i=window.particle.getType();i&&i.emitterMode===cc.ParticleSystem.EmitterMode.GRAVITY?(o=this.initGravityTools(),window.plugin.isGravityTool=!0,window.plugin.tips="重力"):i&&i.emitterMode===cc.ParticleSystem.EmitterMode.RADIUS&&(o=this.initRadiusTools(),window.plugin.isRadiusTool=!0,window.plugin.tips="半径/放射")}if(o){let i=window.particle.getNodeWorldPositionInSvg();o.move(i.x,i.y)}},initRadiusTools(){let i=require("./svgRadiusTool.js"),o=window.particle.getRadius();return this._curTool=i.init(this.draw,o.endR,o.startR,o.rotationPreS),this._curTool},initGravityTools(){let i=require("./svgGravityTool.js"),o=i.init(this.draw);return this._curTool=i,o},initEmmitAngleTools(){let i=require("./svgEmmitAngleTool.js"),o=i.init(this.draw,0);return this._curTool=i,o},initEmmitAreaTools(){let i=window.particle.getParticleSourcePositionVariance(),o=2*i.x,e=2*i.y,t=require("./svgEmmitAreaTool.js"),s=t.init(this.draw,o,e);return this._curTool=t,s},initPositionTools(){let i=require("./svgPositionTool.js"),o=i.init(this.draw);return this._curTool=i,o}};